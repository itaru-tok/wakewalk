# Repository Guidelines

## Project Structure & Module Organization
- The Expo Router entry lives in `app/`, with `app/(tabs)` providing main tab views and `_layout.tsx` orchestrating navigation.
- Shared logic, UI, and styling sit in `src/` (`components/`, `context/`, `hooks/`, `styles/`, `types/`, `utils/`). When in doubt, keep platform-specific code inside `src/native/`.
- Static assets belong in `assets/`. Update `scripts/generate-icons.js` when icon sets change.
- Platform shells (`ios/`, `android/`) are generated by Expo prebuild. Do not edit them unless coordinating with native build work.

## Build, Test, and Development Commands
- `pnpm install` sets up dependencies; pnpm is the canonical package manager.
- `pnpm dev` starts Expo with tunnel + cache reset. `pnpm dev:client` boots the custom dev client.
- Platform targets: `pnpm ios`, `pnpm android`, `pnpm web`. Use `pnpm icons` after adding artwork.
- Quality gates: `pnpm typecheck`, `pnpm lint`, `pnpm lint:fix`, `pnpm format`. Run them before committing.
- EAS builds: `pnpm eas:build:preview:ios` (TestFlight), `pnpm eas:build:production:ios` (App Store).
- OTA updates: `pnpm eas:update:preview "message"` or `pnpm eas:update:production "message"` for JavaScript-only changes (no App Store review needed).

## Coding Style & Naming Conventions
- TypeScript everywhere; prefer function components and hooks housed in `src/hooks`.
- Follow Biomeâ€™s defaults: 2-space indent, 80-char line width, single quotes, trailing commas. Run `pnpm format` instead of manual fixes.
- Components and files use PascalCase (`AlarmSettings.tsx`); hooks and utilities use camelCase.
- Co-locate Tailwind class tokens in `src/styles` helpers; keep magic values inside `src/constants`.

## Testing Guidelines
- Automated tests are not yet wired up; gate changes with `pnpm typecheck` and `pnpm lint`.
- Manual QA: launch via `pnpm dev` and verify wake-flow on both tabs plus vibration/audio toggles.
- If you introduce Jest + React Native Testing Library, place specs under `src/__tests__` or beside components using `*.test.tsx` and add a matching `pnpm test` script.

## Commit & Pull Request Guidelines
- Commits are imperative and lowercase, e.g., `implement vibration on toggle`; group related work logically.
- Branches should mirror the feature or fix (`feature/alarm-scheduler`, `chore/biome-config`).
- Each PR must describe behavior changes, list verification steps (`pnpm dev`, `pnpm typecheck`, `pnpm lint`), and attach screenshots/screen recordings for UI updates.
- Link Linear/GitHub issues when available and update docs (including this file) if the developer workflow shifts.

## Configuration Notes
- Edit Expo settings in `app.config.js`; native build profiles and update channels live in `eas.json`.
- Use `expo prebuild` only when native modules require regeneration (`pnpm prebuild:ios`). Avoid committing credentials or `.env.*` files.
- OTA updates configured with `runtimeVersion: { policy: 'appVersion' }` in `app.config.js` and update channels in `eas.json`.

## Environment Variables & Secrets
- **Local development**: Create a `.env` file in the project root (gitignored). Required variables:
  - `EXPO_PUBLIC_REVENUECAT_IOS_KEY`: RevenueCat API key for subscription management
  - `EXPO_PUBLIC_ADMOB_IOS_BANNER`: AdMob banner ad unit ID
  - `EXPO_PUBLIC_PREMIUM_OVERRIDE`: Set to `"true"` to bypass subscription checks locally
- **EAS builds**: Never commit `.env` files. Use `eas env:create` to configure secrets for `development`, `preview`, and `production` environments.
- **Verification**: Run `eas env:list --environment <env>` to check configured secrets.
- **Why this matters**: Without proper environment variables, RevenueCat fails to initialize (breaking subscriptions) and AdMob shows no ads in production builds.

## Premium Features & Monetization
- **Free tier**: 100 steps in 60 minutes goal, single color theme, ads on stats page
- **Premium tier** (`isPremium` from `PremiumContext`):
  - Gradient theme color with up to 3 colors
  - Custom walk goals (steps & minutes)
  - Ad-free experience
- **RevenueCat integration**: Configured in `src/utils/revenuecat.ts`, consumed via `PremiumContext`
- **AdMob ads**: Only shown to free users; controlled by `!isPremium` check in `stats.tsx`
- **Testing premium features**: Set `EXPO_PUBLIC_PREMIUM_OVERRIDE="true"` in `.env` to bypass subscription checks
